<!DOCTYPE html>
<html prefix="og: http://ogp.me/ns#" lang="en">
  <head>
    <title>passport-dapp-web3</title>
    <meta charset="utf-8">
    <meta name="description" content="Web3 authentication strategy for your dapp :tm: using Passport.">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link rel="canonical" href="https://www.passportjs.org/packages/passport-dapp-web3/">
    <link rel="manifest" href="/manifest.webmanifest"/>
    <meta name="theme-color" content="#35DF79"/>
    <link rel="shortcut icon" href="/images/favicon/favicon.ico"/>
    <link rel="icon" sizes="16x16" type="image/png" href="/images/favicon/favicon-16x16.png"/>
    <link rel="icon" sizes="32x32" type="image/png" href="/images/favicon/favicon-32x32.png"/>
    <link rel="icon" sizes="36x36" type="image/png" href="/images/favicon/android-icon-36x36.png"/>
    <link rel="icon" sizes="48x48" type="image/png" href="/images/favicon/android-icon-48x48.png"/>
    <link rel="icon" sizes="70x70" type="image/png" href="/images/favicon/ms-icon-70x70.png"/>
    <link rel="icon" sizes="72x72" type="image/png" href="/images/favicon/android-icon-72x72.png"/>
    <link rel="icon" sizes="96x96" type="image/png" href="/images/favicon/android-icon-96x96.png"/>
    <link rel="icon" sizes="144x144" type="image/png" href="/images/favicon/ms-icon-144x144.png"/>
    <link rel="icon" sizes="150x150" type="image/png" href="/images/favicon/ms-icon-150x150.png"/>
    <link rel="icon" sizes="192x192" type="image/png" href="/images/favicon/android-icon-192x192.png"/>
    <link rel="icon" sizes="310x310" type="image/png" href="/images/favicon/ms-icon-310x310.png"/>
    <link rel="apple-touch-icon" href="/images/favicon/apple-icon-57x57.png"/>
    <link rel="apple-touch-icon" sizes="60x60" href="/images/favicon/apple-icon-60x60.png"/>
    <link rel="apple-touch-icon" sizes="72x72" href="/images/favicon/apple-icon-72x72.png"/>
    <link rel="apple-touch-icon" sizes="76x76" href="/images/favicon/apple-icon-76x76.png"/>
    <link rel="apple-touch-icon" sizes="114x114" href="/images/favicon/apple-icon-114x114.png"/>
    <link rel="apple-touch-icon" sizes="120x120" href="/images/favicon/apple-icon-120x120.png"/>
    <link rel="apple-touch-icon" sizes="144x144" href="/images/favicon/apple-icon-144x144.png"/>
    <link rel="apple-touch-icon" sizes="152x152" href="/images/favicon/apple-icon-152x152.png"/>
    <link rel="apple-touch-icon" sizes="180x180" href="/images/favicon/apple-icon-180x180.png"/>
    <meta name="msapplication-config" content="/browserconfig.xml"/>
    <meta name="msapplication-TileColor" content="#35DF79"/>
    <meta name="msapplication-TileImage" content="/images/favicon/ms-icon-144x144.png"/>
    <meta property="og:type" content="website"/>
    <meta property="og:title" content="passport-dapp-web3"/>
    <meta property="og:description" content="Web3 authentication strategy for your dapp :tm: using Passport."/>
    <meta property="og:url" content="https://www.passportjs.org/packages/passport-dapp-web3/"/>
    <meta property="og:image" content="https://www.passportjs.org/images/facebook-card.png"/>
    <meta property="og:image:type" content="image/png"/>
    <meta property="og:image:width" content="1200"/>
    <meta property="og:image:height" content="630"/>
    <meta property="og:site_name" content="Passport.js"/>
    <meta name="twitter:card" content="summary_large_image"/>
    <meta name="twitter:site" content="@passportjs"/>
    <meta name="twitter:title" content="passport-dapp-web3"/>
    <meta name="twitter:description" content="Web3 authentication strategy for your dapp :tm: using Passport."/>
    <meta name="twitter:image" content="https://www.passportjs.org/images/twitter-card.png"/>
    <meta name="flattr:id" content="d5znvd"/>
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
      
      ga('create', 'UA-73332146-2', 'auto');
      ga('send', 'pageview');
    </script>
    <!--+google-tag-manager('GTM-M5S3PH')-->
    <!--link(type='text/css', rel='stylesheet', href='http://fast.fonts.net/cssapi/7527d73a-ebfe-45db-a201-ff2812df4b18.css')-->
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.5/styles/default.min.css">
    <link rel="stylesheet" href="/assets/styles/all.css">
    <script data-main="/script/main" src="//cdnjs.cloudflare.com/ajax/libs/require.js/2.3.5/require.js"></script>
  </head>
  <body>
    <div id="container"><span id="top"></span>
      <div id="toolbar">
        <div class="toolbar-search">
          <form action="/search">
            <button type="submit"></button>
            <input type="text" name="q" placeholder="Search for Strategies">
          </form>
        </div>
        <div class="toolbar-social">
          <ul>
            <li class="facebook"><a href="https://www.facebook.com/passportjs" target="_blank"></a></li>
            <li class="twitter"><a href="https://twitter.com/passportjs" target="_blank"></a></li>
            <li class="github"><a href="https://github.com/jaredhanson/passport" target="_blank"><span class="count">0</span></a></li>
          </ul>
        </div>
      </div>
      <nav id="menu"><a class="menu-logo" href="/" title="Passport.js"></a>
        <div class="menu-trigger"><span></span></div>
        <div class="menu-items">
          <ul>
            <li><a href="/">Home</a></li>
            <li><a href="/docs/">Documentation</a></li>
            <li><a href="/features/">Features</a></li>
            <li><a href="/packages/">Strategies</a></li>
          </ul><script async type="text/javascript" src="//cdn.carbonads.com/carbon.js?zoneid=1673&serve=C6AILKT&placement=passportjsorg" id="_carbonads_js"></script>
        </div>
      </nav>
      <div id="content">
        <div class="package hproduct" id="package">
          <div class="description"><p><a href="https://github.com/psychobunny/passport-dapp-web3/actions/workflows/node.js.yml"><img src="https://github.com/psychobunny/passport-dapp-web3/actions/workflows/node.js.yml/badge.svg" alt="Node.js CI"></a></p>
<h1 id="passport-dapp-web3">passport-dapp-web3</h1>
<p><a href="http://passportjs.org/">Passport</a> strategy for authenticating with an address, message, and signed message for one-click secure :tm: SSO for your web3 based dapp.</p>
<p>It&#39;s probably important to note that I have no idea what I&#39;m doing, and so you really should read this code yourself before you put it up on any production environment. But it works for me so please give it a try and submit any pull requests if you find anything derpy.</p>
<p>This is based on <a href="https://github.com/jaredhanson/passport-local">passport-local</a> by <a href="https://github.com/jaredhanson/">Jared Hanson</a>. Additional credit goes to <a href="https://github.com/ChainSafe/web3.js/">web3.js</a> by <a href="https://github.com/ChainSafe/">ChainSafe</a> for doing the heavy lifting.</p>
<hr>
<p align="center">
  <sup>Sponsors</sup>
  <br>
  <a href="https://nodebb.org">
    <img src="https://raw.githubusercontent.com/NodeBB/NodeBB/master/public/images/logo.svg" alt="NodeBB" style="max-width:100%;">
  </a><br/>
  <a href="https://nodebb.org">NodeBB</a> is a node.js-based forum software that&#39;s lightning quick, easily customizable, and of course, open source. And guess what this repository is for! Don&#39;t you want a community platform that you can SSO via your crypto wallet? Of course you do, that&#39;s possibly why you&#39;re here? Go go go fork and have fun! ;D</a>
</p>

<hr>
<h2 id="install">Install</h2>
<pre><code class="lang-bash">$ npm install passport-dapp-web3
</code></pre>
<h2 id="usage">Usage</h2>
<h4 id="configure-strategy">Configure Strategy</h4>
<p>The web3 authentication strategy authenticates users using an address, message, and signed message. 
The strategy requires a <code>verify</code> callback, which accepts these
credentials and calls <code>done</code> providing a user.</p>
<pre><code class="lang-js">passport.use(<span class="keyword">new</span> Web3Strategy(
  <span class="function"><span class="keyword">function</span>(<span class="params">address, message, signed, done</span>) </span>{
    User.findOne({ <span class="attr">address</span>: address }, <span class="function"><span class="keyword">function</span> (<span class="params">err, user</span>) </span>{
      <span class="keyword">if</span> (err) { <span class="keyword">return</span> done(err); }
      <span class="keyword">if</span> (!user) { <span class="keyword">return</span> done(<span class="literal">null</span>, <span class="literal">false</span>); }

      <span class="keyword">return</span> done(<span class="literal">null</span>, user);
    });
  }
));
</code></pre>
<h5 id="available-options">Available Options</h5>
<p>This strategy takes an optional options hash before the function, e.g. <code>new Web3Strategy({/* options */, callback})</code>.</p>
<p>The available options are:</p>
<ul>
<li><code>addressField</code> - Optional, defaults to &#39;address&#39;</li>
<li><code>messageField</code> - Optional, defaults to &#39;message&#39;</li>
<li><code>signedField</code> - Optional, defaults to &#39;signed&#39;</li>
</ul>
<p>Both fields define the name of the properties in the POST body that are sent to the server.</p>
<h4 id="parameters">Parameters</h4>
<p>By default, <code>Web3Strategy</code> expects to find credentials in parameters
named address, message, and signed. If your site prefers to name these fields
differently, options are available to change the defaults. I don&#39;t even
know why I am supporting this but I suppose if you&#39;re too lazy or unable to 
change the existing form that you have, then lucky you.</p>
<pre><code>passport.use(<span class="keyword">new</span> Web3Strategy({
    addressField: <span class="string">'email'</span>,
    messageField: <span class="string">'passwd'</span>,
    signedField: <span class="string">'pineapples'</span>,
    session: <span class="literal">false</span>
  },
  <span class="function"><span class="keyword">function</span><span class="params">(address, message, signed, done)</span> </span>{
    <span class="comment">// ...</span>
  }
));
</code></pre><p>When session support is not necessary, it can be safely disabled by
setting the <code>session</code> option to false.</p>
<p>The verify callback can be supplied with the <code>request</code> object by setting
the <code>passReqToCallback</code> option to true, and changing callback arguments
accordingly.</p>
<pre><code>passport.use(<span class="keyword">new</span> Web3Strategy({
    addressField: <span class="string">'email'</span>,
    messageField: <span class="string">'passwd'</span>,
    passReqToCallback: <span class="literal">true</span>,
    <span class="keyword">session</span>: <span class="literal">false</span>
  },
  <span class="keyword">function</span>(req, address, message, signed, done) {
    // request <span class="keyword">object</span> <span class="keyword">is</span> <span class="keyword">now</span> <span class="keyword">first</span> argument
    // ...
  }
));
</code></pre><h4 id="authenticate-requests">Authenticate Requests</h4>
<p>Use <code>passport.authenticate()</code>, specifying the <code>&#39;web3&#39;</code> strategy, to
authenticate requests.</p>
<p>For example, as route middleware in an <a href="http://expressjs.com/">Express</a>
application:</p>
<pre><code class="lang-js">app.post(<span class="string">'/login'</span>, 
  passport.authenticate(<span class="string">'web3'</span>, { <span class="attr">failureRedirect</span>: <span class="string">'/login'</span> }),
  <span class="function"><span class="keyword">function</span>(<span class="params">req, res</span>) </span>{
    res.redirect(<span class="string">'/'</span>);
  });
</code></pre>
<h2 id="examples">Examples</h2>
<p>If you use this module, please submit a PR to add your project here, even if it&#39;s closed source I&#39;d love to see who is using it! Also, if it&#39;s on GH/etc, someone else can hopefully look at your code as an example on how to implement it. I hit my head against the wall about 99 times on the way to making this repo and the corresponding NodeBB SSO plugin due to lack of examples in the wild so let&#39;s change that. Thanks!</p>
<ul>
<li><a href="https://github.com/psychobunny/nodebb-plugin-sso-web3">NodeBB forum SSO plugin</a></li>
</ul>
<h2 id="license">License</h2>
<p><a href="http://opensource.org/licenses/MIT">The MIT License</a></p>
<p>Copyright (c) 2021 Andrew Carnegie Rodrigues &lt;<a href="https://github.com/psychobunny">https://github.com/psychobunny</a>&gt;</p>
<p>Copyright (c) 2011-2015 Jared Hanson &lt;<a href="http://jaredhanson.net/">http://jaredhanson.net/</a>&gt;</p>
</div>
          <div class="metadata">
            <div class="install"><code>npm install <span class="fn">passport-dapp-web3</span></code></div>
            <ul>
              <li><span class="version">1.0.4</span> published <abbr class="updated" title="2021-03-28T19:04:43Z">10 months ago</abbr></li>
              <li><a class="url" href="https://github.com/psychobunny/passport-dapp-web3">https://github.com/psychobunny/passport-dapp-web3#readme</a></li>
              <li><a rel="licence" href="http://www.opensource.org/licenses/MIT">MIT License</a></li>
            </ul>
            <ul>
              <li><b>2</b> downloads in the last day</li>
              <li><b>23</b> downloads in the last week</li>
              <li><b>122</b> downloads in the last month</li>
            </ul>
          </div>
        </div>
      </div>
    </div>
    <div class="search-con">
      <div class="head"><span class="close-ico"></span>
        <div class="hold">
          <h2>SEARCH FOR STRATEGIES</h2>
          <form action="/">
            <input value="" type="text" name="strategy" placeholder="Start typing" autocomplete="off">
          </form>
          <p class="info-line"><span>0</span>STRATEGIES</p>
        </div>
      </div>
      <div class="results">
        <section></section>
      </div>
    </div>
    <!--+google-tag-manager-noscript('GTM-M5S3PH')-->
  </body>
</html>