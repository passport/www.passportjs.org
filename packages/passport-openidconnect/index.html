<!DOCTYPE html>
<html prefix="og: http://ogp.me/ns#" lang="en">
  <head>
    <title>passport-openidconnect</title>
    <meta charset="utf-8">
    <meta name="description" content="OpenID Connect authentication strategy for Passport.">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link rel="canonical" href="https://www.passportjs.org/packages/passport-openidconnect/">
    <link rel="manifest" href="/manifest.webmanifest"/>
    <meta name="theme-color" content="#35DF79"/>
    <link rel="shortcut icon" href="/images/favicon/favicon.ico"/>
    <link rel="icon" sizes="16x16" type="image/png" href="/images/favicon/favicon-16x16.png"/>
    <link rel="icon" sizes="32x32" type="image/png" href="/images/favicon/favicon-32x32.png"/>
    <link rel="icon" sizes="36x36" type="image/png" href="/images/favicon/android-icon-36x36.png"/>
    <link rel="icon" sizes="48x48" type="image/png" href="/images/favicon/android-icon-48x48.png"/>
    <link rel="icon" sizes="70x70" type="image/png" href="/images/favicon/ms-icon-70x70.png"/>
    <link rel="icon" sizes="72x72" type="image/png" href="/images/favicon/android-icon-72x72.png"/>
    <link rel="icon" sizes="96x96" type="image/png" href="/images/favicon/android-icon-96x96.png"/>
    <link rel="icon" sizes="144x144" type="image/png" href="/images/favicon/ms-icon-144x144.png"/>
    <link rel="icon" sizes="150x150" type="image/png" href="/images/favicon/ms-icon-150x150.png"/>
    <link rel="icon" sizes="192x192" type="image/png" href="/images/favicon/android-icon-192x192.png"/>
    <link rel="icon" sizes="310x310" type="image/png" href="/images/favicon/ms-icon-310x310.png"/>
    <link rel="apple-touch-icon" href="/images/favicon/apple-icon-57x57.png"/>
    <link rel="apple-touch-icon" sizes="60x60" href="/images/favicon/apple-icon-60x60.png"/>
    <link rel="apple-touch-icon" sizes="72x72" href="/images/favicon/apple-icon-72x72.png"/>
    <link rel="apple-touch-icon" sizes="76x76" href="/images/favicon/apple-icon-76x76.png"/>
    <link rel="apple-touch-icon" sizes="114x114" href="/images/favicon/apple-icon-114x114.png"/>
    <link rel="apple-touch-icon" sizes="120x120" href="/images/favicon/apple-icon-120x120.png"/>
    <link rel="apple-touch-icon" sizes="144x144" href="/images/favicon/apple-icon-144x144.png"/>
    <link rel="apple-touch-icon" sizes="152x152" href="/images/favicon/apple-icon-152x152.png"/>
    <link rel="apple-touch-icon" sizes="180x180" href="/images/favicon/apple-icon-180x180.png"/>
    <meta name="msapplication-config" content="/browserconfig.xml"/>
    <meta name="msapplication-TileColor" content="#35DF79"/>
    <meta name="msapplication-TileImage" content="/images/favicon/ms-icon-144x144.png"/>
    <meta property="og:type" content="website"/>
    <meta property="og:title" content="passport-openidconnect"/>
    <meta property="og:description" content="OpenID Connect authentication strategy for Passport."/>
    <meta property="og:url" content="https://www.passportjs.org/packages/passport-openidconnect/"/>
    <meta property="og:image" content="https://www.passportjs.org/images/facebook-card.png"/>
    <meta property="og:image:type" content="image/png"/>
    <meta property="og:image:width" content="1200"/>
    <meta property="og:image:height" content="630"/>
    <meta property="og:site_name" content="Passport.js"/>
    <meta name="twitter:card" content="summary_large_image"/>
    <meta name="twitter:site" content="@passportjs"/>
    <meta name="twitter:title" content="passport-openidconnect"/>
    <meta name="twitter:description" content="OpenID Connect authentication strategy for Passport."/>
    <meta name="twitter:image" content="https://www.passportjs.org/images/twitter-card.png"/>
    <meta name="flattr:id" content="d5znvd"/>
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
      
      ga('create', 'UA-73332146-2', 'auto');
      ga('send', 'pageview');
    </script>
    <!--+google-tag-manager('GTM-M5S3PH')-->
    <!--link(type='text/css', rel='stylesheet', href='http://fast.fonts.net/cssapi/7527d73a-ebfe-45db-a201-ff2812df4b18.css')-->
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.5/styles/default.min.css">
    <link rel="stylesheet" href="/assets/styles/all.css">
    <script data-main="/script/main" src="//cdnjs.cloudflare.com/ajax/libs/require.js/2.3.5/require.js"></script>
  </head>
  <body>
    <div id="container"><span id="top"></span>
      <div id="toolbar">
        <div class="toolbar-search">
          <form action="/search">
            <button type="submit"></button>
            <input type="text" name="q" placeholder="Search for Strategies">
          </form>
        </div>
        <div class="toolbar-social">
          <ul>
            <li class="facebook"><a href="https://www.facebook.com/passportjs" target="_blank"></a></li>
            <li class="twitter"><a href="https://twitter.com/passportjs" target="_blank"></a></li>
            <li class="github"><a href="https://github.com/jaredhanson/passport" target="_blank"><span class="count">0</span></a></li>
          </ul>
        </div>
      </div>
      <nav id="menu"><a class="menu-logo" href="/" title="Passport.js"></a>
        <div class="menu-trigger"><span></span></div>
        <div class="menu-items">
          <ul>
            <li><a href="/">Home</a></li>
            <li><a href="/docs/">Documentation</a></li>
            <li><a href="/features/">Features</a></li>
            <li><a href="/packages/">Strategies</a></li>
          </ul><script async type="text/javascript" src="//cdn.carbonads.com/carbon.js?zoneid=1673&serve=C6AILKT&placement=passportjsorg" id="_carbonads_js"></script>
        </div>
      </nav>
      <div id="content">
        <div class="package hproduct" id="package">
          <div class="description"><h1 id="passport-openidconnect">passport-openidconnect</h1>
<p><a href="https://www.passportjs.org/">Passport</a> strategy for authenticating
with <a href="https://openid.net/connect/">OpenID Connect</a>.</p>
<p>This module lets you authenticate using OpenID Connect in your Node.js
applications.  By plugging into Passport, OpenID Connect authentication can be
easily and unobtrusively integrated into any application or framework that
supports <a href="https://github.com/senchalabs/connect#readme">Connect</a>-style
middleware, including <a href="https://expressjs.com/">Express</a>.</p>
<h2 id="install">Install</h2>
<pre><code class="lang-sh">$ npm install passport-openidconnect
</code></pre>
<h2 id="usage">Usage</h2>
<h4 id="configure">Configure</h4>
<p>The OpenID Connect authentication strategy authenticates users using their
account at an OpenID Provider (OP).  The strategy needs to be configured with
the provider&#39;s endpoints, as well as a client ID and secret that has been issued
by the provider to the app.  Consult the provider&#39;s documentation for the
locations of these endpoints and instructions on how to register a client.</p>
<p>The strategy takes a <code>verify</code> function as an argument, which accepts <code>issuer</code>
and <code>profile</code> as arguments.  When authenticating a request, the strategy uses
the OpenID Connect protocol to obtain this information via a sequence of
redirects and back-channel HTTP requests to the OP.</p>
<p>The <code>verify</code> function is responsible for determining the user to which the
account at the OP belongs.  In cases where the account is logging in for the
first time, a user account is typically created automatically.  Because the
<code>verify</code> function is supplied by the application, the app is free to use any
database of its choosing.  The example below illustrates usage of a SQL
database.</p>
<pre><code class="lang-js"><span class="keyword">var</span> OpenIDConnectStrategy = <span class="built_in">require</span>(<span class="string">'passport-openidconnect'</span>);

passport.use(<span class="keyword">new</span> OpenIDConnectStrategy({
    <span class="attr">issuer</span>: <span class="string">'https://server.example.com'</span>,
    <span class="attr">authorizationURL</span>: <span class="string">'https://server.example.com/authorize'</span>,
    <span class="attr">tokenURL</span>: <span class="string">'https://server.example.com/token'</span>,
    <span class="attr">userInfoURL</span>: <span class="string">'https://server.example.com/userinfo'</span>,
    <span class="attr">clientID</span>: process.env[<span class="string">'CLIENT_ID'</span>],
    <span class="attr">clientSecret</span>: process.env[<span class="string">'CLIENT_SECRET'</span>],
    <span class="attr">callbackURL</span>: <span class="string">'https://client.example.org/cb'</span>
  },
  <span class="function"><span class="keyword">function</span> <span class="title">verify</span>(<span class="params">issuer, profile, cb</span>) </span>{
    db.get(<span class="string">'SELECT * FROM federated_credentials WHERE provider = ? AND subject = ?'</span>, [
      issuer,
      profile.id
    ], <span class="function"><span class="keyword">function</span>(<span class="params">err, cred</span>) </span>{
      <span class="keyword">if</span> (err) { <span class="keyword">return</span> cb(err); }
      <span class="keyword">if</span> (!cred) {
        <span class="comment">// The account at the OpenID Provider (OP) has not logged in to this app</span>
        <span class="comment">// before.  Create a new user account and associate it with the account</span>
        <span class="comment">// at the OP.</span>
        db.run(<span class="string">'INSERT INTO users (name) VALUES (?)'</span>, [
          profile.displayName
        ], <span class="function"><span class="keyword">function</span>(<span class="params">err</span>) </span>{
          <span class="keyword">if</span> (err) { <span class="keyword">return</span> cb(err); }

          <span class="keyword">var</span> id = <span class="keyword">this</span>.lastID;
          db.run(<span class="string">'INSERT INTO federated_credentials (user_id, provider, subject) VALUES (?, ?, ?)'</span>, [
            id,
            issuer,
            profile.id
          ], <span class="function"><span class="keyword">function</span>(<span class="params">err</span>) </span>{
            <span class="keyword">if</span> (err) { <span class="keyword">return</span> cb(err); }
            <span class="keyword">var</span> user = {
              <span class="attr">id</span>: id.toString(),
              <span class="attr">name</span>: profile.displayName
            };
            <span class="keyword">return</span> cb(<span class="literal">null</span>, user);
          });
        });
      } <span class="keyword">else</span> {
        <span class="comment">// The account at the OpenID Provider has previously logged in to the</span>
        <span class="comment">// app.  Get the user account associated with the account at the OP and</span>
        <span class="comment">// log the user in.</span>
        db.get(<span class="string">'SELECT * FROM users WHERE id = ?'</span>, [ cred.user_id ], <span class="function"><span class="keyword">function</span>(<span class="params">err, user</span>) </span>{
          <span class="keyword">if</span> (err) { <span class="keyword">return</span> cb(err); }
          <span class="keyword">if</span> (!user) { <span class="keyword">return</span> cb(<span class="literal">null</span>, <span class="literal">false</span>); }
          <span class="keyword">return</span> cb(<span class="literal">null</span>, user);
        });
      }
    }
  })
));
</code></pre>
<h4 id="routes">Routes</h4>
<p>Two routes are needed in order to allow users to log in with their account at an
OP.  The first route redirects the user to the OP, where they will authenticate:</p>
<pre><code class="lang-js">app.get(<span class="string">'/login'</span>, passport.authenticate(<span class="string">'openidconnect'</span>));
</code></pre>
<p>The second route processes the authentication response and logs the user in,
when the OP redirects the user back to the app:</p>
<pre><code class="lang-js">app.get(<span class="string">'/cb'</span>,
  passport.authenticate(<span class="string">'openidconnect'</span>, { <span class="attr">failureRedirect</span>: <span class="string">'/login'</span>, <span class="attr">failureMessage</span>: <span class="literal">true</span> }),
  <span class="function"><span class="keyword">function</span>(<span class="params">req, res</span>) </span>{
    res.redirect(<span class="string">'/'</span>);
  });
</code></pre>
<h2 id="license">License</h2>
<p><a href="https://opensource.org/licenses/MIT">The MIT License</a></p>
<p>Copyright (c) 2011-2021 Jared Hanson &lt;<a href="https://www.jaredhanson.me/">https://www.jaredhanson.me/</a>&gt;</p>
</div>
          <div class="metadata">
            <div class="install"><code>npm install <span class="fn">passport-openidconnect</span></code></div>
            <ul>
              <li><span class="version">0.1.1</span> published <abbr class="updated" title="2021-11-29T22:54:01Z">25 days ago</abbr></li>
              <li><a class="url" href="https://github.com/jaredhanson/passport-openidconnect">https://github.com/jaredhanson/passport-openidconnect#readme</a></li>
              <li><a rel="licence" href="http://www.opensource.org/licenses/MIT">MIT License</a></li>
            </ul>
            <ul>
              <li><b>1,921</b> downloads in the last day</li>
              <li><b>13,142</b> downloads in the last week</li>
              <li><b>59,893</b> downloads in the last month</li>
            </ul>
          </div>
        </div>
      </div>
    </div>
    <div class="search-con">
      <div class="head"><span class="close-ico"></span>
        <div class="hold">
          <h2>SEARCH FOR STRATEGIES</h2>
          <form action="/">
            <input value="" type="text" name="strategy" placeholder="Start typing" autocomplete="off">
          </form>
          <p class="info-line"><span>0</span>STRATEGIES</p>
        </div>
      </div>
      <div class="results">
        <section></section>
      </div>
    </div>
    <!--+google-tag-manager-noscript('GTM-M5S3PH')-->
  </body>
</html>