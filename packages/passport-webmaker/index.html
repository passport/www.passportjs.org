<!DOCTYPE html>
<html prefix="og: http://ogp.me/ns#" lang="en">
  <head>
    <title>passport-webmaker</title>
    <meta charset="utf-8">
    <meta name="description" content="Webmaker authentication strategy for passport.js">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link rel="canonical" href="http://www.passportjs.org/packages/passport-webmaker/">
    <link rel="manifest" href="/manifest.webmanifest"/>
    <meta name="theme-color" content="#35DF79"/>
    <link rel="shortcut icon" href="/images/favicon/favicon.ico"/>
    <link rel="icon" sizes="16x16" type="image/png" href="/images/favicon/favicon-16x16.png"/>
    <link rel="icon" sizes="32x32" type="image/png" href="/images/favicon/favicon-32x32.png"/>
    <link rel="icon" sizes="36x36" type="image/png" href="/images/favicon/android-icon-36x36.png"/>
    <link rel="icon" sizes="48x48" type="image/png" href="/images/favicon/android-icon-48x48.png"/>
    <link rel="icon" sizes="70x70" type="image/png" href="/images/favicon/ms-icon-70x70.png"/>
    <link rel="icon" sizes="72x72" type="image/png" href="/images/favicon/android-icon-72x72.png"/>
    <link rel="icon" sizes="96x96" type="image/png" href="/images/favicon/android-icon-96x96.png"/>
    <link rel="icon" sizes="144x144" type="image/png" href="/images/favicon/ms-icon-144x144.png"/>
    <link rel="icon" sizes="150x150" type="image/png" href="/images/favicon/ms-icon-150x150.png"/>
    <link rel="icon" sizes="192x192" type="image/png" href="/images/favicon/android-icon-192x192.png"/>
    <link rel="icon" sizes="310x310" type="image/png" href="/images/favicon/ms-icon-310x310.png"/>
    <link rel="apple-touch-icon" href="/images/favicon/apple-icon-57x57.png"/>
    <link rel="apple-touch-icon" sizes="60x60" href="/images/favicon/apple-icon-60x60.png"/>
    <link rel="apple-touch-icon" sizes="72x72" href="/images/favicon/apple-icon-72x72.png"/>
    <link rel="apple-touch-icon" sizes="76x76" href="/images/favicon/apple-icon-76x76.png"/>
    <link rel="apple-touch-icon" sizes="114x114" href="/images/favicon/apple-icon-114x114.png"/>
    <link rel="apple-touch-icon" sizes="120x120" href="/images/favicon/apple-icon-120x120.png"/>
    <link rel="apple-touch-icon" sizes="144x144" href="/images/favicon/apple-icon-144x144.png"/>
    <link rel="apple-touch-icon" sizes="152x152" href="/images/favicon/apple-icon-152x152.png"/>
    <link rel="apple-touch-icon" sizes="180x180" href="/images/favicon/apple-icon-180x180.png"/>
    <meta name="msapplication-config" content="/browserconfig.xml"/>
    <meta name="msapplication-TileColor" content="#35DF79"/>
    <meta name="msapplication-TileImage" content="/images/favicon/ms-icon-144x144.png"/>
    <meta property="og:type" content="website"/>
    <meta property="og:title" content="passport-webmaker"/>
    <meta property="og:description" content="Webmaker authentication strategy for passport.js"/>
    <meta property="og:url" content="http://www.passportjs.org/packages/passport-webmaker/"/>
    <meta property="og:image" content="http://www.passportjs.org/images/facebook-card.png"/>
    <meta property="og:image:type" content="image/png"/>
    <meta property="og:image:width" content="1200"/>
    <meta property="og:image:height" content="630"/>
    <meta property="og:site_name" content="Passport.js"/>
    <meta name="twitter:card" content="summary_large_image"/>
    <meta name="twitter:site" content="@passportjs"/>
    <meta name="twitter:title" content="passport-webmaker"/>
    <meta name="twitter:description" content="Webmaker authentication strategy for passport.js"/>
    <meta name="twitter:image" content="http://www.passportjs.org/images/twitter-card.png"/>
    <meta name="flattr:id" content="d5znvd">
    <link type="text/css" rel="stylesheet" href="http://fast.fonts.net/cssapi/7527d73a-ebfe-45db-a201-ff2812df4b18.css">
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.5/styles/default.min.css">
    <link rel="stylesheet" href="/assets/styles/all.css">
    <script data-main="/script/main" src="//cdnjs.cloudflare.com/ajax/libs/require.js/2.3.5/require.js"></script>
  </head>
  <body>
    <div id="container"><span id="top"></span>
      <div id="toolbar">
        <div class="toolbar-search">
          <form action="/search">
            <button type="submit"></button>
            <input type="text" name="q" placeholder="Search for Strategies">
          </form>
        </div>
        <div class="toolbar-social">
          <ul>
            <li class="facebook"><a href="https://www.facebook.com/passportjs" target="_blank"></a></li>
            <li class="twitter"><a href="https://twitter.com/passportjs" target="_blank"></a></li>
            <li class="github"><a href="https://github.com/jaredhanson/passport" target="_blank"><span class="count">0</span></a></li>
          </ul>
        </div>
      </div>
      <nav id="menu"><a class="menu-logo" href="/" title="Passport.js"></a>
        <div class="menu-trigger"><span></span></div>
        <div class="menu-items">
          <ul>
            <li><a href="/">Home</a></li>
            <li><a href="/docs/">Documentation</a></li>
            <li><a href="/features/">Features</a></li>
            <li><a href="/packages/">Strategies</a></li>
          </ul><script async type="text/javascript" src="//cdn.carbonads.com/carbon.js?zoneid=1673&serve=C6AILKT&placement=passportjsorg" id="_carbonads_js"></script>
        </div><a class="supported" href="http://auth0.com" target="_blank">Supported by<i class="auth0"></i></a>
      </nav>
      <div id="content">
        <div class="package hproduct" id="package">
          <div class="description"><h1 id="-rocket-passport-webmaker">:rocket: passport-webmaker</h1>
<p><a href="http://passportjs.org/">Passport</a> strategy for authenticating with <a href="https://webmaker.org/">Webmaker</a> using the OAuth 2.0 API.</p>
<p>This module lets you authenticate using Webmaker in your Node.js applications.
By plugging into Passport, Webmaker authentication can be easily and
unobtrusively integrated into any application or framework that supports
<a href="http://www.senchalabs.org/connect/">Connect</a>-style middleware, including
<a href="http://expressjs.com/">Express</a>.</p>
<h2 id="install">Install</h2>
<p><code>$ npm install passport-webmaker</code></p>
<h2 id="usage">Usage</h2>
<h4 id="create-an-application">Create an Application</h4>
<p>Before using <code>passport-webmaker</code>, you must register your application and generate appropriate credentials.</p>
<p>If you want to register your application with Mozilla&#39;s production/staging instances of id.webmaker.org then send an email to
<code>devops@mozillafoundation.org</code> with the information detailed and outlined <a href="https://github.com/mozilla/id.webmaker.org/blob/master/docs/oauth.md#registering-your-application">here</a>.
Note that registration requests can be denied at any time, for any reason and that these requests are typically not granted to applications
outside the relevant scope of Mozilla&#39;s products and services.</p>
<p>Alternatively, if you are running your own instance of id.webmaker.org you can generate these tokens yourself, although this process is currently
not documented and outside the scope of this project. Upon registration by either method your application will be issued a <code>clientID</code> and <code>clientSecret</code>
which will need to be provided to the strategy as explained below. You will also need to configure a redirect URI that matches the route in your application.</p>
<h4 id="configure-strategy">Configure Strategy</h4>
<p>The Webmaker authentication strategy authenticates users using a Webmaker account and OAuth 2.0 tokens.
The client ID and secret obtained when creating an application are supplied as options when creating the strategy.
The strategy also requires a <code>verify</code> callback, which receives the access token and optional refresh token,
as well as <code>profile</code> which contains the authenticated user&#39;s Webmaker profile. The <code>verify</code> callback must call <code>done</code>
providing a user to complete authentication.</p>
<pre><code class="lang-js">passport.use(<span class="keyword">new</span> WebmakerStrategy({
    <span class="attr">clientID</span>: WEBMAKER_CLIENT_ID,
    <span class="attr">clientSecret</span>: WEBMAKER_CLIENT_SECRET,
    <span class="attr">state</span>: <span class="literal">true</span>
  },
  <span class="function"><span class="keyword">function</span>(<span class="params">accessToken, refreshToken, profile, done</span>) </span>{
    User.findOrCreate({ <span class="attr">id</span>: profile.id }, <span class="function"><span class="keyword">function</span> (<span class="params">err, user</span>) </span>{
      <span class="keyword">return</span> done(err, user);
    });
  }
 ));
</code></pre>
<h4 id="authenticate-requests">Authenticate Requests</h4>
<p> Use <code>passport.authenticate()</code>, specifying the <code>&#39;webmaker&#39;</code> strategy, to authenticate requests.</p>
<p> For example, as route middleware in an <a href="https://expressjs.com/">Express</a> application:</p>
<pre><code class="lang-js"> app.get(<span class="string">'/auth/webmaker'</span>, passport.authenticate(<span class="string">'webmaker'</span>));

 app.get(<span class="string">'/auth/webmaker/callback'</span>,
     passport.authenticate(<span class="string">'webmaker'</span>, { <span class="attr">failureRedirect</span>: <span class="string">'/login'</span>, <span class="attr">successfulRedirect</span>: <span class="string">'/'</span>}));
</code></pre>
<h2 id="faq">FAQ</h2>
<p>These are some answers to the most frequently asked questions, if you have additional questions feel free
to submit an issue ticket and tag whomever is the current project maintainer as well.</p>
<h5 id="how-do-you-ask-for-additional-permissions-information-">How do you ask for additional permissions/information?</h5>
<p>You can request additional permissions by appending parameters to the <code>scopes</code> option in <code>passport.authenticate()</code>.</p>
<pre><code class="lang-js">app.get(<span class="string">'/auth/webmaker'</span>,
  passport.authenticate(<span class="string">'webmaker'</span>, { <span class="attr">scopes</span>: [<span class="string">'user'</span>, <span class="string">'email'</span>] }));
</code></pre>
<p><strong>Note:</strong> Your parameter must be called <code>scopes</code> (plural) and not <code>scope</code> (singular), otherwise this will throw an error.</p>
<h5 id="what-is-the-structure-of-the-user-information-returned-">What is the structure of the user information returned?</h5>
<p>We follow the standard convention for normalizing profiles as detailed by <a href="http://passportjs.org/docs/profile">passport.js</a>.</p>
<pre><code class="lang-json">{
  <span class="attr">"provider"</span>:<span class="string">"webmaker"</span>,
  <span class="attr">"id"</span>:<span class="number">1022</span>,
  <span class="attr">"displayName"</span>:<span class="string">"ryan"</span>,
  <span class="attr">"locale"</span>:<span class="string">"en-US"</span>,
  <span class="attr">"emails"</span>:[
    {
      <span class="attr">"value"</span>:<span class="string">"hello@myemail.com"</span>
    }
  ],
  <span class="attr">"photos"</span>:[
    {
      <span class="attr">"value"</span>:<span class="string">"https://example.com/ryan/webmaker-avatar-200x200.png"</span>
    }
  ]
}
</code></pre>
<h5 id="how-can-you-change-what-instance-of-id-webmaker-org-is-being-used-">How can you change what instance of id.webmaker.org is being used?</h5>
<p>By default all authentication will go through <code>https://id.webmaker.org</code> however, it&#39;s also possible to point
passport-webmaker at your own instance of <code>id.webmaker.org</code>. This is especially helpful if maybe you want to
debug on a developmental/staging server, like we do here at Mozilla on a regular basis.</p>
<p>Below we append three parameters to the options object to be used when creating the strategy. They are:
<code>authorizationURL</code>, <code>tokenURL</code> and <code>profileURL</code>. Changing these three URLs is all you need to change your <code>id</code> instance.</p>
<pre><code class="lang-js">passport.use(<span class="keyword">new</span> WebmakerStrategy({
    <span class="attr">clientID</span>: WEBMAKER_CLIENT_ID,
    <span class="attr">clientSecret</span>: WEBMAKER_CLIENT_SECRET,
    <span class="attr">state</span>: <span class="literal">true</span>,
    <span class="attr">authorizationURL</span>: <span class="string">"https://id.mofostaging.net/login/oauth/authorize"</span>,
    <span class="attr">tokenURL</span>: <span class="string">"https://id.mofostaging.net/login/oauth/access_token"</span>,
    <span class="attr">profileURL</span>: <span class="string">"https://id.mofostaging.net/user"</span>
  },
  <span class="function"><span class="keyword">function</span>(<span class="params">accessToken, refreshToken, profile, done</span>) </span>{
    User.findOrCreate({ <span class="attr">id</span>: profile.id }, <span class="function"><span class="keyword">function</span> (<span class="params">err, user</span>) </span>{
      <span class="keyword">return</span> done(err, user);
    });
  }
 ));
</code></pre>
<h5 id="how-can-i-change-the-login-flow-used-by-passport-webmaker-">How can I change the login flow used by <code>passport-webmaker</code>?</h5>
<p>You can tell <code>passport-webmaker</code> to use the <code>signup</code> flow vs. the <code>signin</code> flow by assigning the string value to the optional <code>action</code> parameter when calling <code>passport.authenticate()</code>. The default is <code>signin</code>.</p>
<pre><code class="lang-js">app.get(<span class="string">'/auth/webmaker'</span>,
  passport.authenticate(<span class="string">'webmaker'</span>, { <span class="attr">scopes</span>: [<span class="string">'user'</span>, <span class="string">'email'</span>], <span class="attr">action</span>: <span class="string">"signup"</span> }));
</code></pre>
<h5 id="what-is-error-oauth-2-0-authentication-requires-session-support-when-using-state-">What is &quot;Error: OAuth 2.0 authentication requires session support when using state.&quot;?</h5>
<p><code>passport-webmaker</code> requires persistent login session support in order to be used properly. It is a requirement
of using passport.js&#39;s internal implementation of <code>state</code> which is a randomly generated string used to prevent
CSRF-like attacks and other man-in-the-middle intrusions. Often times errors like these occur when your web app
doesn&#39;t support sessions, or they aren&#39;t being configured properly with passport.js.</p>
<p>Check out the passport.js documentation for information on <a href="http://passportjs.org/docs/configure">configuring login sessions</a>.</p>
<h5 id="misc-potential-errors-and-their-causes">Misc. potential errors and their causes</h5>
<p><strong>Error:</strong> &quot;{&quot;statusCode&quot;:400,&quot;error&quot;:&quot;Bad Request&quot;,&quot;message&quot;:&quot;child \&quot;state\&quot; fails because [\&quot;state\&quot; is required]&quot;,&quot;validation&quot;:{&quot;source&quot;:&quot;query&quot;,&quot;keys&quot;:[&quot;state&quot;]}}&quot;</p>
<p><strong>Cause:</strong> You have either forgotten to set the <code>state</code> parameter when initializing your strategy, or have disabled it by setting it to <code>false</code>.</p>
<p><strong>Error:</strong> The <code>refreshToken</code> parameter is undefined.</p>
<p><strong>Cause:</strong> This is perfectly normal, <code>id</code> doesn&#39;t support this type of request. It&#39;s just a place holder.</p>
<h2 id="credits">Credits</h2>
<ul>
<li><a href="https://github.com/jaredhanson">Jared Hanson</a> for his incredible work on passport.js, great documentation and more.<ul>
<li>Some code snippets and documentation layout were also heavily inspired by his work on his own passport modules!</li>
</ul>
</li>
<li><strong>MoFo DevOps</strong> for providing guidance and technical support where necessary, as well as insight on the OAuth flow.</li>
</ul>
</div>
          <div class="metadata">
            <div class="install"><code>npm install <span class="fn">passport-webmaker</span></code></div>
            <ul>
              <li><span class="version">1.1.1</span> published <abbr class="updated" title="2017-09-01T23:35:27Z">5 months ago</abbr></li>
              <li><a class="url" href="git://github.com/mozilla/passport-webmaker.git">https://github.com/mozilla/passport-webmaker#readme</a></li>
              <li><a rel="licence" href="http://www.mozilla.org/MPL/2.0/">Mozilla Public License 2.0</a></li>
            </ul>
            <ul>
              <li><b>0</b> downloads in the last day</li>
              <li><b>0</b> downloads in the last week</li>
              <li><b>17</b> downloads in the last month</li>
            </ul>
          </div>
        </div><a class="supported" href="http://auth0.com" target="_blank">Supported by<i class="auth0"></i></a>
      </div>
    </div>
    <div class="search-con">
      <div class="head"><span class="close-ico"></span>
        <div class="hold">
          <h2>SEARCH FOR STRATEGIES</h2>
          <form action="/">
            <input value="" type="text" name="strategy" placeholder="Start typing" autocomplete="off">
          </form>
          <p class="info-line"><span>0</span>STRATEGIES</p>
        </div>
      </div>
      <div class="results">
        <section></section>
      </div>
    </div>
    <script>
      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-104798-10']);
      _gaq.push(['_trackPageview']);
      
      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();
      
    </script>
    <!-- Google Tag Manager-->
    <noscript>iframe(src='//www.googletagmanager.com/ns.html?id=GTM-M5S3PH', height='0', width='0', style='display:none;visibility:hidden')</noscript>
    <script>
      (function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
      new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
      j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
      '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
      })(window,document,'script','dataLayer','GTM-M5S3PH');
    </script>
    <!-- End Google Tag Manager-->
  </body>
</html>