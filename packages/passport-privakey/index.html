<!DOCTYPE html>
<html prefix="og: http://ogp.me/ns#" lang="en">
  <head>
    <title>passport-privakey</title>
    <meta charset="utf-8">
    <meta name="description" content="Use passport to authenticate to the Privakey service in Node.js">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link rel="canonical" href="http://www.passportjs.org/packages/passport-privakey/">
    <link rel="manifest" href="/manifest.webmanifest"/>
    <meta name="theme-color" content="#35DF79"/>
    <link rel="shortcut icon" href="/images/favicon/favicon.ico"/>
    <link rel="icon" sizes="16x16" type="image/png" href="/images/favicon/favicon-16x16.png"/>
    <link rel="icon" sizes="32x32" type="image/png" href="/images/favicon/favicon-32x32.png"/>
    <link rel="icon" sizes="36x36" type="image/png" href="/images/favicon/android-icon-36x36.png"/>
    <link rel="icon" sizes="48x48" type="image/png" href="/images/favicon/android-icon-48x48.png"/>
    <link rel="icon" sizes="70x70" type="image/png" href="/images/favicon/ms-icon-70x70.png"/>
    <link rel="icon" sizes="72x72" type="image/png" href="/images/favicon/android-icon-72x72.png"/>
    <link rel="icon" sizes="96x96" type="image/png" href="/images/favicon/android-icon-96x96.png"/>
    <link rel="icon" sizes="144x144" type="image/png" href="/images/favicon/ms-icon-144x144.png"/>
    <link rel="icon" sizes="150x150" type="image/png" href="/images/favicon/ms-icon-150x150.png"/>
    <link rel="icon" sizes="192x192" type="image/png" href="/images/favicon/android-icon-192x192.png"/>
    <link rel="icon" sizes="310x310" type="image/png" href="/images/favicon/ms-icon-310x310.png"/>
    <link rel="apple-touch-icon" href="/images/favicon/apple-icon-57x57.png"/>
    <link rel="apple-touch-icon" sizes="60x60" href="/images/favicon/apple-icon-60x60.png"/>
    <link rel="apple-touch-icon" sizes="72x72" href="/images/favicon/apple-icon-72x72.png"/>
    <link rel="apple-touch-icon" sizes="76x76" href="/images/favicon/apple-icon-76x76.png"/>
    <link rel="apple-touch-icon" sizes="114x114" href="/images/favicon/apple-icon-114x114.png"/>
    <link rel="apple-touch-icon" sizes="120x120" href="/images/favicon/apple-icon-120x120.png"/>
    <link rel="apple-touch-icon" sizes="144x144" href="/images/favicon/apple-icon-144x144.png"/>
    <link rel="apple-touch-icon" sizes="152x152" href="/images/favicon/apple-icon-152x152.png"/>
    <link rel="apple-touch-icon" sizes="180x180" href="/images/favicon/apple-icon-180x180.png"/>
    <meta name="msapplication-config" content="/browserconfig.xml"/>
    <meta name="msapplication-TileColor" content="#35DF79"/>
    <meta name="msapplication-TileImage" content="/images/favicon/ms-icon-144x144.png"/>
    <meta property="og:type" content="website"/>
    <meta property="og:title" content="passport-privakey"/>
    <meta property="og:description" content="Use passport to authenticate to the Privakey service in Node.js"/>
    <meta property="og:url" content="http://www.passportjs.org/packages/passport-privakey/"/>
    <meta property="og:image" content="http://www.passportjs.org/images/facebook-card.png"/>
    <meta property="og:image:type" content="image/png"/>
    <meta property="og:image:width" content="1200"/>
    <meta property="og:image:height" content="630"/>
    <meta property="og:site_name" content="Passport.js"/>
    <meta name="twitter:card" content="summary_large_image"/>
    <meta name="twitter:site" content="@passportjs"/>
    <meta name="twitter:title" content="passport-privakey"/>
    <meta name="twitter:description" content="Use passport to authenticate to the Privakey service in Node.js"/>
    <meta name="twitter:image" content="http://www.passportjs.org/images/twitter-card.png"/>
    <meta name="flattr:id" content="d5znvd"/>
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
      
      ga('create', 'UA-73332146-2', 'auto');
      ga('send', 'pageview');
    </script>
    <!--+google-tag-manager('GTM-M5S3PH')-->
    <!--link(type='text/css', rel='stylesheet', href='http://fast.fonts.net/cssapi/7527d73a-ebfe-45db-a201-ff2812df4b18.css')-->
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.5/styles/default.min.css">
    <link rel="stylesheet" href="/assets/styles/all.css">
    <script data-main="/script/main" src="//cdnjs.cloudflare.com/ajax/libs/require.js/2.3.5/require.js"></script>
  </head>
  <body>
    <div id="container"><span id="top"></span>
      <div id="toolbar">
        <div class="toolbar-search">
          <form action="/search">
            <button type="submit"></button>
            <input type="text" name="q" placeholder="Search for Strategies">
          </form>
        </div>
        <div class="toolbar-social">
          <ul>
            <li class="facebook"><a href="https://www.facebook.com/passportjs" target="_blank"></a></li>
            <li class="twitter"><a href="https://twitter.com/passportjs" target="_blank"></a></li>
            <li class="github"><a href="https://github.com/jaredhanson/passport" target="_blank"><span class="count">0</span></a></li>
          </ul>
        </div>
      </div>
      <nav id="menu"><a class="menu-logo" href="/" title="Passport.js"></a>
        <div class="menu-trigger"><span></span></div>
        <div class="menu-items">
          <ul>
            <li><a href="/">Home</a></li>
            <li><a href="/docs/">Documentation</a></li>
            <li><a href="/features/">Features</a></li>
            <li><a href="/packages/">Strategies</a></li>
          </ul><script async type="text/javascript" src="//cdn.carbonads.com/carbon.js?zoneid=1673&serve=C6AILKT&placement=passportjsorg" id="_carbonads_js"></script>
        </div>
      </nav>
      <div id="content">
        <div class="package hproduct" id="package">
          <div class="description"><h1 id="passport-privakey">passport-privakey</h1>
<p><a href="https://opensource.org/licenses/MIT"><img src="https://img.shields.io/badge/license-mit-blue.svg" alt="license:mit"></a></p>
<p>A <a href="http://passportjs.org/">Passport</a> strategy for authenticating with <a href="https://www.privakey.com/">Privakey</a>.</p>
<p>This module lets you authenticate using Privakey in your Node.js applications.
Built on top of Passport, Privakey authentication can be easily and
unobtrusively integrated into any application or framework that supports
<a href="http://www.senchalabs.org/connect/">Connect</a>-style middleware, including
<a href="http://expressjs.com/">Express</a>.</p>
<h2 id="install">Install</h2>
<pre><code class="lang-bash">$ npm install passport-privakey
</code></pre>
<h2 id="about-privakey">About Privakey</h2>
<p>Logging in with Privakey is simple and secure.  Like a social login (e.g. Sign in with Google), one can use their Privakey Login anywhere that accepts Privakey.  Unlike a social login, Privakey is:</p>
<ul>
<li><em>Secure</em> - By having users use a registered Privakey application (available for Android, iOS and Google Chrome) and a PIN, Privakey enables simple, multi-factor login.</li>
<li><em>Flexible</em> - If you don&#39;t want or need multi-factor login for you application, Privakey can be configured for pin-less and password-less Tap In authentication.</li>
<li><em>Private</em> - Privakey respects you and your user&#39;s privacy. Login history isn&#39;t shared with anybody.</li>
</ul>
<p>Privakey leverages proprietary authentication schemes on top of standards-based OpenID Connect protocols.  Learn more about Privakey at <a href="www.privakey.com">www.privakey.com</a>.</p>
<h2 id="usage">Usage</h2>
<h4 id="configure-strategy">Configure Strategy</h4>
<p>The Privakey authentication strategy leverages the passport-openidconnect strategy to authenticates users, minimizing the amount of configuration required to enable it.  To enable Privakey you must instantiate an instance of the passport-privakey strategy with variables configured in the <a href="https://portal.privakey.com">Privakey Relying Party Administration Portal</a>.  For more information see <a href="#prerequisites">Prerequisites</a>.</p>
<pre><code class="lang-javascript"><span class="keyword">var</span> passport = <span class="built_in">require</span>(<span class="string">'passport'</span>),
  PrivakeyStrategy = <span class="built_in">require</span>(<span class="string">'passport-privakey'</span>).Strategy,
  <span class="comment">// Example of creating a user variable (from meanjs.org stack)</span>
  <span class="comment">// Must adjust to conform to your applications user controller/model</span>
  users = <span class="built_in">require</span>(<span class="string">'../../controllers/users.server.controller'</span>);

<span class="built_in">module</span>.exports = <span class="function"><span class="keyword">function</span> (<span class="params">config</span>) </span>{

  passport.use(<span class="keyword">new</span> PrivakeyStrategy({
    <span class="attr">clientID</span>: config.privakey.clientID,
    <span class="attr">clientSecret</span>: config.privakey.clientSecret,
    <span class="attr">callbackURL</span>: config.privakey.callbackURL,
    <span class="attr">scope</span>: <span class="string">'openid profile email'</span>,
    <span class="attr">passReqToCallback</span>: <span class="literal">true</span>
  },
  <span class="function"><span class="keyword">function</span> (<span class="params">req, accessToken, refreshToken, profile, done</span>) </span>{
    <span class="comment">//  Set the provider data and include tokens</span>
    <span class="keyword">var</span> providerData = profile._json;
    providerData.accessToken = accessToken;
    providerData.refreshToken = refreshToken;

    <span class="comment">//  Example: normalize returned Privakey data to be consumed in user model</span>
    <span class="keyword">var</span> providerUserProfile = {
      <span class="attr">firstName</span>: profile.name.givenName,
      <span class="attr">lastName</span>: profile.name.familyName,
      <span class="attr">displayName</span>: profile.displayName,
      <span class="attr">email</span>: profile._json.email,
      <span class="attr">username</span>: profile.username,
      <span class="attr">provider</span>: <span class="string">'privakey'</span>,
      <span class="attr">providerIdentifierField</span>: <span class="string">'sub'</span>,
      <span class="attr">providerData</span>: providerData
    };

    <span class="comment">// Save the normalize Privakey profile information</span>
    users.saveOAuthUserProfile(req, providerUserProfile, done);
  }));
};
</code></pre>
<h4 id="authenticate-requests">Authenticate Requests</h4>
<p>Use <code>passport.authenticate()</code>, specifying the <code>&#39;privakey&#39;</code> strategy, to
authenticate requests.  </p>
<p><strong><em>NOTE</em></strong>: passport-privakey requires a state in order to complete the authenticate process.  Be sure to set a <code>state</code> in your <code>req.session</code> if you want to use and manage your own state.  If you don&#39;t provide a state <strong>before</strong> calling passport.authenticate(), a state will be generated for you and stored in the session.  The state is an &quot;opaque value used to maintain state between the request and the callback. Typically, Cross-Site Request Forgery (CSRF, XSRF) mitigation is done by cryptographically binding the value of this parameter with a browser cookie.&quot; (<a href="http://openid.net/specs/openid-connect-core-1_0.html">openIDConnect spec</a>)</p>
<p>For example, as route middleware in an <a href="http://expressjs.com/">Express</a>
application:</p>
<pre><code class="lang-javascript">app.get(<span class="string">'/auth/privakey'</span>,
  passport.authenticate(<span class="string">'privakey'</span>));

app.get(<span class="string">'/auth/privakey/callback'</span>,
  passport.authenticate(<span class="string">'privakey'</span>, { <span class="attr">failureRedirect</span>: <span class="string">'/login'</span> }),
  <span class="function"><span class="keyword">function</span>(<span class="params">req, res</span>) </span>{
    <span class="comment">// Successful authentication, redirect home.</span>
    res.redirect(<span class="string">'/'</span>);
  });
</code></pre>
<h2 id="example">Example</h2>
<p>For a complete, working example, refer to the <a href="https://github.com/privakey/meanjs-example">Privakey MeanJS Example Application</a>.</p>
<h2 id="prerequisites">Prerequisites</h2>
<p>Before you can enable Privakey for your application, you will need to get the Privakey Application and sign up to be a Privakey Relying Party.</p>
<ol>
<li><p><a href="http://get.privakey.com">Get the Privakey app</a>. </p>
</li>
<li><p>Register as a Relying Party</p>
<ul>
<li>Log into <a href="https://portal.privakey.com">Privakey&#39;s User Portal</a> and sign up to be a Relying Party.</li>
<li><p>You will need to create a Relying Party.  Information you&#39;ll need to provide, includes:</p>
<p><strong>Friendly Name</strong>: This is how the applications name will present on the end-user’s pending authentication page and Privakey Apps.</p>
<p><strong>Logo</strong>: Optionally, one can upload a logo that will appear on the pending authentication page presented to users during authentications.</p>
<p><strong>Call Back URI</strong>: URI’s to which a user returns with references to their Token.  After a successful Authentication on Privakey (See Usage for more details). For a standard Passport implementation this will be:  &quot;https://[base_uri]/auth/privakey/callback&quot;.  Any callback URI defined in your application, must be configured in the Privakey Relying Party administration screens. A Service may have more than one callback URI.</p>
<p><strong>Require PIN?</strong>: Privakey Authentications can be configured to require or not require the use of a PIN during authentications. For secure Authentications, the use of a PIN is recommended. However, there may be certain instances where a service may want a more convenient method of user authentication. This is configured for each Callback URI, so a service can leverage both method (for example: requiring a PIN to log in to the account but not requiring a PIN to process a transaction once logged in).</p>
<p><strong>Implicit Flow</strong>: Privakey supports two OpenID Connect Protocols; Should be left at the default. More information about these different protocols can be found on OpenID.org. The passport-privakey module assumes Code Flow, as it is a more secure protocol.</p>
</li>
</ul>
</li>
</ol>
<p>For more detailed documentation on Privakey&#39;s service, visit <a href="http://docs.privakey.com">Privakey Documentation</a>.</p>
<h2 id="credits">Credits</h2>
<p>This module was developed by Joseph Chew (with some assistance by Brian Ross) of Privakey.</p>
<ul>
<li><a href="http://github.com/privakey">Joseph Chew</a></li>
<li><a href="http://github.com/privakey">Brian Ross</a></li>
</ul>
<p>Both Joe and Brian are greatly indebted to the following for their contributions to Passport and its numerous strategies:</p>
<ul>
<li><a href="http://github.com/jaredhanson">Jared Hanson</a></li>
<li><a href="https://github.com/shekhei">Wong Shek Hei</a></li>
</ul>
</div>
          <div class="metadata">
            <div class="install"><code>npm install <span class="fn">passport-privakey</span></code></div>
            <ul>
              <li><span class="version">1.0.3</span> published <abbr class="updated" title="2017-11-14T19:22:04Z">3 years ago</abbr></li>
              <li><a class="url" href="git+https://github.com/privakey/passport-privakey.git">https://github.com/privakey/passport-privakey#readme</a></li>
              <li><a rel="licence" href="http://www.opensource.org/licenses/MIT">MIT License</a></li>
            </ul>
            <ul>
              <li><b>0</b> downloads in the last day</li>
              <li><b>2</b> downloads in the last week</li>
              <li><b>14</b> downloads in the last month</li>
            </ul>
          </div>
        </div>
      </div>
    </div>
    <div class="search-con">
      <div class="head"><span class="close-ico"></span>
        <div class="hold">
          <h2>SEARCH FOR STRATEGIES</h2>
          <form action="/">
            <input value="" type="text" name="strategy" placeholder="Start typing" autocomplete="off">
          </form>
          <p class="info-line"><span>0</span>STRATEGIES</p>
        </div>
      </div>
      <div class="results">
        <section></section>
      </div>
    </div>
    <!--+google-tag-manager-noscript('GTM-M5S3PH')-->
  </body>
</html>